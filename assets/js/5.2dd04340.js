(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{154:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),a("hr"),a("p",[t._v("跨域请求针对浏览器的同源策略(Same-Origin Policy)而言，指一个网站主动请求另外一个网站的资源(图片、javascript、视频等)。")]),a("p",[t._v("同源策略要求网站只能有限制的访问外部网站的资源，不合法的请求会被拦截。网站的源由协议、域名、端口三部分组成，有一部分不同就被视为不同源，两个不同的域名即便指向同一个ip地址也是跨域的。网站通过AJAX请求资源是典型的跨域请求，需要外部网站许可才能访问。\n")]),t._m(1),a("p",[t._v("跨域请求针对浏览器的同源策略(Same-Origin Policy)而言，指一个网站主动请求另外一个网站的资源(图片、javascript、视频等)。")]),a("p",[t._v("同源策略要求网站只能有限制的访问外部网站的资源，不合法的请求会被拦截。网站的源由协议、域名、端口三部分组成，有一部分不同就被视为不同源，两个不同的域名即便指向同一个ip地址也是跨域的。网站通过AJAX请求资源是典型的跨域请求，需要外部网站许可才能访问。")]),a("p",[t._v("同源策略是浏览器端的安全限制。")]),t._m(2),t._m(3),t._m(4),t._m(5),a("p",[t._v("通常浏览器控制台会明确打印出跨域错误及其帮助信息，如：")]),t._m(6),t._m(7),t._m(8),a("p",[t._v("基本主流浏览器都已经支持。")]),t._m(9),t._m(10),t._m(11),t._m(12),a("p",[t._v("GET, HEAD, POST 方法，并且POST方法的Content-Type只包含 text/plain, application/x-www-form-urlencoded, multipart/form-data")]),t._m(13),a("p",[t._v("在简单请求之外的其它请求发出前，都会先发一个OPTION请求，以探测服务器是否支持及允许CORS请求的配置参数。")]),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19),t._m(20),a("p",[t._v("因此要支持Cookies的跨域，需要服务器端返回如下头：")]),t._m(21),a("p",[t._v("除此之外，前端在进行请求时需要特别标注：")]),t._m(22),t._m(23),a("p",[t._v("主要有两种方法：")]),t._m(24),a("ol",[a("li",[t._v("查看控制台出错日志信息")]),a("li",[t._v("下载 "),a("a",{attrs:{href:"https://chrome.google.com/webstore/detail/nlfbmbojpeacfghkpbjhddihlkkiljbi",target:"_blank",rel:"noopener noreferrer"}},[t._v("CORS 调试"),a("OutboundLink")],1),t._v("  浏览器插件，开启后重新请求")])]),t._m(25),t._m(26),t._m(27),t._m(28),t._m(29),a("p",[t._v("注意：")]),t._m(30),t._m(31),t._m(32),t._m(33),t._m(34),t._m(35)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"有关跨域-cors-及-nginx-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#有关跨域-cors-及-nginx-配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 有关跨域 CORS 及 Nginx 配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"什么是跨域？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是跨域？","aria-hidden":"true"}},[this._v("#")]),this._v(" 什么是跨域？")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/assets/images/15178986212867.jpg",alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("“Domains, protocols and ports must match”")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"跨域对前端的影响"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域对前端的影响","aria-hidden":"true"}},[this._v("#")]),this._v(" 跨域对前端的影响")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("AJAX：请求无法发送和接收")]),s("li",[this._v("WebFonts：字体文件无法从别的域加载")]),s("li",[this._v("SVG：通过use引用的外部资源无法使用")]),s("li",[this._v("Canvas/WebGL：如无法读取图片的点阵数据，无法toDateURL等")]),s("li",[this._v("Video：无法截取快照")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/assets/images/15178986972043.jpg",alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"cors的浏览器支持"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cors的浏览器支持","aria-hidden":"true"}},[this._v("#")]),this._v(" CORS的浏览器支持")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/assets/images/15178987236463.jpg",alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"跨域请求过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域请求过程","aria-hidden":"true"}},[this._v("#")]),this._v(" 跨域请求过程")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/assets/images/15178987563714.jpg",alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("首先查看http头部有无origin字段；")]),s("li",[this._v("如果没有，或者不允许，直接当成普通请求处理，结束；")]),s("li",[this._v("如果有并且是允许的，那么再看是否是preflight(method=OPTIONS)；")]),s("li",[this._v("如果是preflight，就返回Allow-Headers、Allow-Methods等，内容为空；")]),s("li",[this._v("如果不是preflight，就返回Allow-Origin、Allow-Credentials等，并返回正常内容。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"简单请求-simple-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简单请求-simple-request","aria-hidden":"true"}},[this._v("#")]),this._v(" 简单请求(Simple Request)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"预请求-preflighted-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#预请求-preflighted-request","aria-hidden":"true"}},[this._v("#")]),this._v(" 预请求(Preflighted Request)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("我们的大多数AJAX请求包含Authentication头，因此这些都不会是简单请求，所有请求都需要先发一个预请求。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"跨域相关http-headers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域相关http-headers","aria-hidden":"true"}},[this._v("#")]),this._v(" 跨域相关HTTP Headers")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"相关headers介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相关headers介绍","aria-hidden":"true"}},[this._v("#")]),this._v(" 相关Headers介绍")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/assets/images/15179074088703.jpg",alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("请求头都是由浏览器自动生成的，根据请求的不是当前域进行判断。")]),s("li",[this._v("服务器端需要支持OPTION请求，并返回204")]),s("li",[this._v("其它请求服务器端需要添加http headers即可，所有验证逻辑均在浏览器端完成。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"支持cookies的跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#支持cookies的跨域","aria-hidden":"true"}},[this._v("#")]),this._v(" 支持Cookies的跨域")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("若接口（比如http://api.com/ping）需要在自己域（http://api.com）下读写Cookies, 在没有 "),s("code",[this._v("Access-Control-Allow-Credentials: true")]),this._v(" 的请求中，Cookies是不支持的，即 接口不能够读写域下的Cookies 。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v('// OPTION Request\nOPTIONS /api/v1/captcha?deviceId=web20180110_71007&platform=desktop-web&env=Chrome&vendor=web&lang=&appVer=4.0.0 HTTP/1.1\nHost: test-oauth.itiger.com\nAccess-Control-Request-Method: GET\nOrigin: https://test-web.itiger.com\nAccess-Control-Request-Headers: authorization\nAccept: */*\nAccept-Encoding: gzip, deflate, br\nAccept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7\n\n\n// OPTION Response\nHTTP/1.1 204 No Content\nDate: Wed, 10 Jan 2018 09:13:22 GMT\nContent-Type: text/plain charset=UTF-8\nConnection: keep-alive\nServer: nginx/1.9.6\nAccess-Control-Allow-Origin: https://test-web.itiger.com\nAccess-Control-Allow-Credentials: true\nAccess-Control-Allow-Methods: POST, GET, OPTIONS, HEAD, DELETE, PUT\nAccess-Control-Allow-Headers: DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization\n\n\n// GET Request\nGET /api/v1/captcha?deviceId=web20180110_71007&platform=desktop-web&env=Chrome&vendor=web&lang=&appVer=4.0.0 HTTP/1.1\nHost: test-oauth.itiger.com\nConnection: keep-alive\n\nAccept: application/json, text/plain, */*\nOrigin: https://test-web.itiger.com\nAuthorization: Bearer gMnH2uCUzsoncdiC90XJaYDpoYgxDYiBMydIUGfC9NDkfSiiD0\n\n\n\n// GET Response\nHTTP/1.1 200 OK\nDate: Wed, 10 Jan 2018 09:16:19 GMT\nContent-Type: application/json\nTransfer-Encoding: chunked\nConnection: keep-alive\nVary: Accept-Encoding\nServer: TornadoServer/3.2.2\nEtag: W/"d8b94d7da2b3d9cec8a195d024dea7147a470d4b"\nPragma: no-store\nCache-Control: no-store\nSet-Cookie: captcha="2|1:0|10:1515575779|7:captcha|88:NDdkNmYzYjYwMzQ5N2ViNTU0YjQ0YmEyNTY3MDVjZmVkMWNmZTc1ODRmNzNiNGNjN2M1Yzc5Mzg4MjE0YTg3Yg==|7fe5bc2d6d748af5fd3442a09ad07f8d819db249e0c13d1047e1411611e25878"; expires=Fri, 09 Feb 2018 09:16:19 GMT; Path=/\nAccess-Control-Allow-Origin: https://test-web.itiger.com\nAccess-Control-Allow-Credentials: true\nAccess-Control-Allow-Methods: POST, GET, OPTIONS, HEAD, DELETE, PUT\nAccess-Control-Allow-Headers: Referer,Accept,Origin,User-Agent,Authorization,NT,X-CustomHeader,Keep-Alive,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Connection,DNT\nContent-Encoding: gzip\n')])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// Vanilla")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" xhr "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("withCredentials "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// JQuery")]),t._v("\n$"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("ajax")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    type"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'POST'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    dataType"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    xhrFields"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       withCredentials"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// Vue-resource")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" result "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("this")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$http"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("get")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  credentials"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"调试cors请求问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调试cors请求问题","aria-hidden":"true"}},[this._v("#")]),this._v(" 调试CORS请求问题")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"简单判定是否cors问题，"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简单判定是否cors问题，","aria-hidden":"true"}},[this._v("#")]),this._v(" 简单判定是否CORS问题，")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/assets/images/15179075649303.jpg",alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("注意：\n开启并用默认配置("),s("em",[this._v("😕/")]),this._v(")，可能会导致某些网站访问异常，如GitHub。建议自行添加过滤。\n此种方法也适用于开发时调用暂未配置跨域的接口。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"用charles修改http请求调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用charles修改http请求调试","aria-hidden":"true"}},[this._v("#")]),this._v(" 用Charles修改HTTP请求调试")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"nginx-配置参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置参考","aria-hidden":"true"}},[this._v("#")]),this._v(" Nginx 配置参考")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$http_origin")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$allow_origin")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  default "),a("span",{attrs:{class:"token string"}},[t._v('""')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"~^https?://(?:[^/]*\\.)?(stevebuzonas\\.(?:com|local))(?::[0-9]+)?$"')]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"$http_origin"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$request_method")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_method")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  default "),a("span",{attrs:{class:"token string"}},[t._v('"allowed"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"OPTIONS"')]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"preflight"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_method")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_max_age")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  default "),a("span",{attrs:{class:"token string"}},[t._v('""')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"preflight"')]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1728000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_method")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_allow_methods")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  default "),a("span",{attrs:{class:"token string"}},[t._v('""')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"preflight"')]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"GET, POST, OPTIONS"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_method")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_allow_headers")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  default "),a("span",{attrs:{class:"token string"}},[t._v('""')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"preflight"')]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Authorization,Content-Type,Accept,Origin,User-Agent,DNT,Cache-Control,X-Mx-ReqToken,Keep-Alive,X-Requested-With,If-Modified-Since,Authorization"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_method")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_content_length")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  default "),a("span",{attrs:{class:"token variable"}},[t._v("$initial_content_length")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"preflight"')]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("map")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_method")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_content_type")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  default "),a("span",{attrs:{class:"token variable"}},[t._v("$initial_content_type")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"preflight"')]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"text/plain charset=UTF-8"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Access"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("Allow")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Origin "),a("span",{attrs:{class:"token variable"}},[t._v("$allow_origin")]),t._v(" always"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Access"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("Allow")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Credentials "),a("span",{attrs:{class:"token string"}},[t._v("'true'")]),t._v(" always"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Access"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Max"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Age "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_max_age")]),t._v(" always"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Access"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("Allow")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Methods "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_allow_methods")]),t._v(" always"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Access"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Control"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token keyword"}},[t._v("Allow")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Headers "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_allow_headers")]),t._v(" always"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$initial_content_length")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$sent_http_content_length")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Content-Length'")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('""')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Content-Length'")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_content_length")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$initial_content_type")]),t._v(" "),a("span",{attrs:{class:"token variable"}},[t._v("$sent_http_content_type")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Content"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Type "),a("span",{attrs:{class:"token string"}},[t._v('""')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Content"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Type "),a("span",{attrs:{class:"token variable"}},[t._v("$cors_content_type")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token variable"}},[t._v("$request_method")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'OPTIONS'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("204")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",[a("li",[t._v("相关Access-Control的add_header后加了"),a("code",[t._v("always")]),t._v("，因为默认情况下，"),a("code",[t._v("add_header")]),t._v("只作用于状态码为 200, 201 (1.3.10), 204, 206, 301, 302, 303, 304, 307 (1.1.16, 1.0.13), or 308 (1.13.0) 之中的响应，并不支持40x,50x等，因此添加"),a("code",[t._v("always")]),t._v("可以支持所有状态码。 见：http://nginx.org/en/docs/http/ngx_http_headers_module.html#add_header")]),a("li",[t._v("之所以用"),a("code",[t._v("map")]),t._v("命令而不是"),a("code",[t._v("if")]),t._v("，是由于if其实是归属于nginx_rewrite模块的，对于"),a("code",[t._v("try_files")]),t._v("等会不支持，Nginx官方也并不建议使用"),a("code",[t._v("if")]),t._v("。见：https://www.nginx.com/resources/wiki/start/topics/depth/ifisevil/")]),a("li",[t._v("以上"),a("code",[t._v("nginx-cors.conf")]),t._v("可如下方式使用：")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("include")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("cors"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("http")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("4000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  proxy_set_http_header HOST "),a("span",{attrs:{class:"token variable"}},[t._v("$http_host")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"参考资源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资源","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考资源")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("https://www.w3.org/TR/cors/")]),s("li",[this._v("https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS")]),s("li",[this._v("https://www.test-cors.org/")]),s("li",[this._v("https://enable-cors.org/index.html")]),s("li",[this._v("https://www.html5rocks.com/en/tutorials/cors/")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"扩展知识"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#扩展知识","aria-hidden":"true"}},[this._v("#")]),this._v(" 扩展知识")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("HTTPS")]),s("li",[this._v("Nginx")]),s("li",[this._v("CSP")]),s("li",[this._v("HTTP/1.1 vs HTTP2")])])}],!1,null,null,null);s.default=e.exports}}]);